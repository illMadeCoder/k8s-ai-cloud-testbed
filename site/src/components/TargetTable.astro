---
import type { TargetSummary } from '../types';

interface Props {
  targets: TargetSummary[];
}

const { targets } = Astro.props;
---

<details class="section">
  <summary class="section-title">Targets</summary>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Cluster Type</th>
        <th>Machine Type</th>
        <th>Nodes</th>
        <th>Components</th>
      </tr>
    </thead>
    <tbody>
      {targets.map((t) => {
        const comps = t.components ?? [];
        const count = comps.length;
        return (
          <tr>
            <td><code>{t.name}</code></td>
            <td>{t.clusterType}</td>
            <td>{t.machineType ?? '—'}</td>
            <td>{t.nodeCount ?? '—'}</td>
            <td>
              {count === 0 ? '—' : (
                <details class="components-details">
                  <summary>{count} resource{count !== 1 ? 's' : ''}</summary>
                  <div class="components-list">
                    {comps.map((c) => <code class="component-tag">{c}</code>)}
                  </div>
                </details>
              )}
            </td>
          </tr>
        );
      })}
    </tbody>
  </table>
</details>

<style>
  .components-details summary {
    cursor: pointer;
    color: var(--accent);
    font-weight: 500;
    font-size: 0.85rem;
  }
  .components-list {
    margin-top: 0.5rem;
    max-height: 200px;
    overflow-y: auto;
    display: flex;
    flex-wrap: wrap;
    gap: 0.25rem;
  }
  .component-tag {
    font-size: 0.7rem;
    padding: 0.1rem 0.35rem;
    white-space: nowrap;
  }
</style>
