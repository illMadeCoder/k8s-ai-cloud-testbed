---
import Base from '../../layouts/Base.astro';
import Breadcrumb from '../../components/Breadcrumb.astro';
import ExperimentGroupCard from '../../components/ExperimentGroupCard.astro';
import {
  loadAllExperiments,
  groupByProject,
} from '../../lib/experiments';
import { loadProjects, getProjectMeta } from '../../lib/projects';
import type { ExperimentGroup } from '../../lib/experiments';

export function getStaticPaths() {
  const projects = loadProjects();
  const experiments = loadAllExperiments();
  const byProject = groupByProject(experiments);

  return projects.map((p) => ({
    params: { id: p.id },
    props: {
      project: p,
      groups: byProject[p.id] ?? [],
    },
  }));
}

interface ProjectMeta {
  id: string;
  name: string;
  description: string;
}

interface Props {
  project: ProjectMeta;
  groups: ExperimentGroup[];
}

const { project, groups } = Astro.props;
const base = import.meta.env.BASE_URL;
---

<Base title={`${project.name} â€” K8s Cloud TestBed`}>
  <Breadcrumb
    crumbs={[
      { label: 'Home', href: base },
      { label: project.name },
    ]}
    slot="breadcrumb"
  />

  <div class="mb-8">
    <h1 class="text-2xl font-bold mb-2">{project.name}</h1>
    <p class="text-text-muted max-w-2xl">{project.description}</p>
  </div>

  {groups.length === 0 ? (
    <div class="text-center py-16 text-text-muted">
      <p class="text-lg mb-2">Coming soon</p>
      <p class="text-sm">Experiments for this project are planned. Check back later.</p>
    </div>
  ) : (
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
      {groups.map((group) => (
        <ExperimentGroupCard group={group} />
      ))}
    </div>
  )}
</Base>
