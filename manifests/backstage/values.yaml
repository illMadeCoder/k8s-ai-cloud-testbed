# Backstage Helm values for lab environment
# Uses the vanilla demo image - suitable for testing/learning

backstage:
  # Increase startup probe timing - Backstage takes a while to initialize
  startupProbe:
    httpGet:
      path: /.backstage/health/v1/liveness
      port: 7007
      scheme: HTTP
    initialDelaySeconds: 30
    periodSeconds: 10
    failureThreshold: 30
    timeoutSeconds: 5

  image:
    registry: ghcr.io
    repository: backstage/backstage
    tag: latest

  extraEnvVars:
    - name: APP_CONFIG_app_baseUrl
      value: "http://localhost:7007"
    - name: APP_CONFIG_backend_baseUrl
      value: "http://localhost:7007"

  appConfig:
    app:
      title: "K8s Lab Backstage"
      baseUrl: http://localhost:7007

    organization:
      name: "K8s Lab"

    backend:
      baseUrl: http://localhost:7007
      listen:
        port: 7007
      csp:
        connect-src: ["'self'", "http:", "https:"]
      cors:
        origin: http://localhost:7007
        methods: [GET, HEAD, PATCH, POST, PUT, DELETE]
        credentials: true
      database:
        client: better-sqlite3
        connection: ":memory:"

    # TechDocs configuration (required by vanilla image)
    techdocs:
      builder: local
      generator:
        runIn: local
      publisher:
        type: local

    catalog:
      import:
        entityFilename: catalog-info.yaml
      rules:
        - allow: [Component, System, API, Resource, Location, Template]

# Service configuration (top-level, not under backstage)
service:
  type: NodePort

# Disable PostgreSQL for simplicity in lab (uses in-memory SQLite)
postgresql:
  enabled: false
