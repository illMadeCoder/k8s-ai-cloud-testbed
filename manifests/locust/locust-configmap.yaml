apiVersion: v1
kind: ConfigMap
metadata:
  name: locust-scripts
  namespace: locust
data:
  # Steady load test - constant RPS
  steady_load.py: |
    from locust import HttpUser, task, between

    class SteadyLoadUser(HttpUser):
        wait_time = between(1, 2)

        @task(3)
        def read_endpoint(self):
            self.client.get("/api/items")

        @task(1)
        def write_endpoint(self):
            self.client.post("/api/items", json={"name": "test"})

  # Spike test - sudden burst
  spike_test.py: |
    from locust import HttpUser, task, between, events
    import time

    class SpikeTestUser(HttpUser):
        wait_time = between(0.1, 0.5)

        @task
        def spike_load(self):
            # Aggressive load
            self.client.get("/api/items")
            self.client.get("/health")

  # Ramp up test - gradual increase
  ramp_up.py: |
    from locust import HttpUser, task, between, LoadTestShape

    class RampUpUser(HttpUser):
        wait_time = between(1, 3)

        @task
        def gradual_load(self):
            self.client.get("/api/items")

    class StagesShape(LoadTestShape):
        """
        Step load pattern:
        - 0-60s: 10 users
        - 60-120s: 50 users
        - 120-180s: 100 users
        - 180-240s: 200 users
        """
        stages = [
            {"duration": 60, "users": 10, "spawn_rate": 2},
            {"duration": 120, "users": 50, "spawn_rate": 5},
            {"duration": 180, "users": 100, "spawn_rate": 10},
            {"duration": 240, "users": 200, "spawn_rate": 20},
        ]

        def tick(self):
            run_time = self.get_run_time()
            for stage in self.stages:
                if run_time < stage["duration"]:
                    tick_data = (stage["users"], stage["spawn_rate"])
                    return tick_data
            return None

  # API + Storage mixed workload
  api_storage_mixed.py: |
    from locust import HttpUser, task, between
    import random
    import string

    class MixedWorkloadUser(HttpUser):
        wait_time = between(0.5, 2)

        @task(5)
        def read_heavy(self):
            """Read operations - 50% of traffic"""
            self.client.get("/api/items")
            self.client.get("/api/items/" + str(random.randint(1, 100)))

        @task(2)
        def write_operations(self):
            """Write operations - 20% of traffic"""
            data = {
                "name": ''.join(random.choices(string.ascii_letters, k=10)),
                "value": random.randint(1, 1000)
            }
            self.client.post("/api/items", json=data)

        @task(2)
        def update_operations(self):
            """Update operations - 20% of traffic"""
            item_id = random.randint(1, 100)
            self.client.put(f"/api/items/{item_id}", json={"value": random.randint(1, 1000)})

        @task(1)
        def delete_operations(self):
            """Delete operations - 10% of traffic"""
            item_id = random.randint(1, 100)
            self.client.delete(f"/api/items/{item_id}")

  # Health check focused test
  health_check.py: |
    from locust import HttpUser, task, between

    class HealthCheckUser(HttpUser):
        wait_time = between(0.1, 0.3)

        @task
        def health_check(self):
            self.client.get("/health")
