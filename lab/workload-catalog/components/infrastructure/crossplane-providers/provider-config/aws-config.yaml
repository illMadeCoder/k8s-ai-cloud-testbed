---
# AWS ProviderConfig with IRSA (IAM Roles for Service Accounts)
# This configuration uses IRSA for authentication
# No secrets required - credentials are obtained via OIDC federation
#
# Prerequisites:
# 1. EKS cluster must have OIDC provider configured
# 2. IAM role must be created with trust policy for crossplane-system:provider-aws-*
# 3. IAM role must have appropriate AWS IAM policies attached
#
# The IRSA configuration is handled by the ControllerConfig serviceAccount annotation
# which is set automatically by the EKS Terraform module
apiVersion: aws.upbound.io/v1beta1
kind: ProviderConfig
metadata:
  name: default
  annotations:
    argocd.argoproj.io/sync-wave: "2"
spec:
  credentials:
    source: IRSA
---
# Alternative ProviderConfig for development/testing with Secret
# Uncomment and use this when IRSA is not available (e.g., minikube with LocalStack)
# apiVersion: aws.upbound.io/v1beta1
# kind: ProviderConfig
# metadata:
#   name: aws-secret
# spec:
#   credentials:
#     source: Secret
#     secretRef:
#       namespace: crossplane-system
#       name: aws-credentials
#       key: credentials
---
# ProviderConfig for LocalStack (local development)
# Use this for testing Crossplane locally without real AWS credentials
# apiVersion: aws.upbound.io/v1beta1
# kind: ProviderConfig
# metadata:
#   name: localstack
# spec:
#   credentials:
#     source: Secret
#     secretRef:
#       namespace: crossplane-system
#       name: localstack-credentials
#       key: credentials
#   endpoint:
#     url:
#       type: Static
#       static: http://localstack.localstack:4566
#     hostnameImmutable: true
