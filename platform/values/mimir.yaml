# Grafana Mimir values for hub cluster
# Uses SeaweedFS S3-compatible storage backend
# Minimal single-node distributed setup

mimir:
  structuredConfig:
    # No query-scheduler â€” querier connects directly to query-frontend
    frontend:
      scheduler_address: ""
    frontend_worker:
      scheduler_address: ""
      frontend_address: mimir-query-frontend-headless.observability.svc:9095

    common:
      storage:
        backend: s3
        s3:
          endpoint: seaweedfs-s3.seaweedfs.svc.cluster.local:8333
          bucket_name: mimir-blocks
          access_key_id: any
          secret_access_key: any
          insecure: true

    # Single-node settings
    ingester:
      ring:
        replication_factor: 1

    # 7 day retention
    limits:
      compactor_blocks_retention_period: 168h

    # Blocks storage
    blocks_storage:
      backend: s3
      s3:
        endpoint: seaweedfs-s3.seaweedfs.svc.cluster.local:8333
        bucket_name: mimir-blocks
        access_key_id: any
        secret_access_key: any
        insecure: true

    # Ruler storage
    ruler_storage:
      backend: s3
      s3:
        endpoint: seaweedfs-s3.seaweedfs.svc.cluster.local:8333
        bucket_name: mimir-ruler
        access_key_id: any
        secret_access_key: any
        insecure: true

    # Alertmanager storage
    alertmanager_storage:
      backend: s3
      s3:
        endpoint: seaweedfs-s3.seaweedfs.svc.cluster.local:8333
        bucket_name: mimir-alertmanager
        access_key_id: any
        secret_access_key: any
        insecure: true

# Minimal single-node components
ingester:
  replicas: 1
  zoneAwareReplication:
    enabled: false
  affinity: ~
  resources:
    requests:
      cpu: 100m
      memory: 256Mi
    limits:
      cpu: 500m
      memory: 512Mi
  persistentVolume:
    enabled: true
    storageClass: local-path
    size: 2Gi

distributor:
  replicas: 1
  affinity: ~
  resources:
    requests:
      cpu: 50m
      memory: 128Mi
    limits:
      cpu: 200m
      memory: 256Mi

querier:
  replicas: 1
  affinity: ~
  resources:
    requests:
      cpu: 50m
      memory: 128Mi
    limits:
      cpu: 200m
      memory: 256Mi

query_frontend:
  replicas: 1
  affinity: ~
  resources:
    requests:
      cpu: 50m
      memory: 128Mi
    limits:
      cpu: 200m
      memory: 256Mi

compactor:
  replicas: 1
  affinity: ~
  resources:
    requests:
      cpu: 50m
      memory: 128Mi
    limits:
      cpu: 200m
      memory: 256Mi
  persistentVolume:
    enabled: true
    storageClass: local-path
    size: 2Gi

store_gateway:
  replicas: 1
  zoneAwareReplication:
    enabled: false
  affinity: ~
  resources:
    requests:
      cpu: 50m
      memory: 128Mi
    limits:
      cpu: 200m
      memory: 256Mi
  persistentVolume:
    enabled: true
    storageClass: local-path
    size: 2Gi

# Disable components not needed for minimal setup
query_scheduler:
  replicas: 0
ruler:
  replicas: 0
alertmanager:
  replicas: 0
overrides_exporter:
  replicas: 0

# Disable nginx and minio (we have SeaweedFS)
nginx:
  enabled: false
minio:
  enabled: false

# Gateway for API access
gateway:
  enabledNonEnterprise: true
  replicas: 1
  affinity: ~
  resources:
    requests:
      cpu: 50m
      memory: 64Mi
    limits:
      cpu: 200m
      memory: 256Mi

rollout_operator:
  enabled: true
