# Kyverno values for Talos cluster
# Minimal config for learning environment

# Fix kubectl image for cleanup jobs (1.30.2 doesn't exist)
cleanupJobs:
  admissionReports:
    image:
      registry: docker.io
      repository: bitnami/kubectl
      tag: "1.31"
  clusterAdmissionReports:
    image:
      registry: docker.io
      repository: bitnami/kubectl
      tag: "1.31"

# Admission controller config
admissionController:
  replicas: 1
  resources:
    limits:
      memory: 384Mi
    requests:
      cpu: 100m
      memory: 128Mi
  container:
    # Generous startup probe for single-node cluster where API server may be slow
    startupProbe:
      httpGet:
        path: /health/liveness
        port: 9443
        scheme: HTTPS
      failureThreshold: 30
      periodSeconds: 10
  # Use Ignore so pods can still be created when Kyverno is unhealthy
  # For homelab, availability > strict policy enforcement
  webhookConfiguration:
    failurePolicy: Ignore

# Background controller for generate/mutate policies
backgroundController:
  replicas: 1
  resources:
    limits:
      memory: 128Mi
    requests:
      cpu: 50m
      memory: 64Mi

# Cleanup controller
cleanupController:
  replicas: 1
  resources:
    limits:
      memory: 128Mi
    requests:
      cpu: 50m
      memory: 64Mi

# Reports controller
reportsController:
  replicas: 1
  resources:
    limits:
      memory: 128Mi
    requests:
      cpu: 50m
      memory: 64Mi

# Enable policy reports
features:
  policyReports:
    enabled: true
