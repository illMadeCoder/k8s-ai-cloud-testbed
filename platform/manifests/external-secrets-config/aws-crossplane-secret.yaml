# ExternalSecret for AWS Crossplane Provider
#
# Syncs AWS IAM user credentials from OpenBao to crossplane-system.
# The secret format matches what provider-aws expects for Secret auth.

apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: aws-crossplane-credentials
  namespace: crossplane-system
spec:
  refreshInterval: 1h
  secretStoreRef:
    kind: ClusterSecretStore
    name: openbao
  target:
    name: aws-credentials
    creationPolicy: Owner
    template:
      type: Opaque
      data:
        # AWS provider expects INI-style credentials file
        credentials: |
          [default]
          aws_access_key_id = {{ .accessKeyId }}
          aws_secret_access_key = {{ .secretAccessKey }}
  data:
    - secretKey: accessKeyId
      remoteRef:
        key: cloud/aws
        property: accessKeyId
    - secretKey: secretAccessKey
      remoteRef:
        key: cloud/aws
        property: secretAccessKey
