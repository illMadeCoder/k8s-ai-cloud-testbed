# ExternalSecret for Claude Code Credentials
#
# Syncs Claude Code credentials file (with refresh token) from OpenBao to
# experiment-operator-system. The full credentials JSON is mounted as a file
# into the analyzer container at ~/.claude/.credentials.json, enabling the
# Claude Code CLI to auto-refresh expired access tokens.
#
# Store credentials in OpenBao (full credentials.json with refresh token):
#   bao kv put secret/experiment-operator/claude-auth credentials="$(cat ~/.claude/.credentials.json)"

apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: claude-auth
  namespace: experiment-operator-system
spec:
  refreshInterval: 1h
  secretStoreRef:
    kind: ClusterSecretStore
    name: openbao
  target:
    name: claude-auth
    creationPolicy: Owner
    template:
      type: Opaque
      data:
        credentials.json: "{{ .credentials }}"
  data:
    - secretKey: credentials
      remoteRef:
        key: experiment-operator/claude-auth
        property: credentials
