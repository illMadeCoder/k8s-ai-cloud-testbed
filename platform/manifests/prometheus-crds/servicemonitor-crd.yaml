# ServiceMonitor CRD from prometheus-operator
# Required for Grafana, Tempo, and other apps that create ServiceMonitors
# Source: https://github.com/prometheus-operator/prometheus-operator/blob/main/example/prometheus-operator-crd/monitoring.coreos.com_servicemonitors.yaml
#
# This is a minimal install - just the CRD, not the full prometheus-operator
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    controller-gen.kubebuilder.io/version: v0.16.1
  name: servicemonitors.monitoring.coreos.com
spec:
  group: monitoring.coreos.com
  names:
    categories:
      - prometheus-operator
    kind: ServiceMonitor
    listKind: ServiceMonitorList
    plural: servicemonitors
    shortNames:
      - smon
    singular: servicemonitor
  scope: Namespaced
  versions:
    - name: v1
      schema:
        openAPIV3Schema:
          description: ServiceMonitor defines monitoring for a set of services.
          properties:
            apiVersion:
              type: string
            kind:
              type: string
            metadata:
              type: object
            spec:
              description: Specification of desired Service selection for target discovery by Prometheus.
              properties:
                attachMetadata:
                  properties:
                    node:
                      type: boolean
                  type: object
                bodySizeLimit:
                  pattern: (^0|([0-9]*[.])?[0-9]+((K|M|G|T|E|P)i?)?B)$
                  type: string
                endpoints:
                  items:
                    properties:
                      authorization:
                        properties:
                          credentials:
                            properties:
                              key:
                                type: string
                              name:
                                type: string
                              optional:
                                type: boolean
                            required:
                              - key
                            type: object
                          type:
                            type: string
                        type: object
                      basicAuth:
                        properties:
                          password:
                            properties:
                              key:
                                type: string
                              name:
                                type: string
                              optional:
                                type: boolean
                            required:
                              - key
                            type: object
                          username:
                            properties:
                              key:
                                type: string
                              name:
                                type: string
                              optional:
                                type: boolean
                            required:
                              - key
                            type: object
                        type: object
                      bearerTokenSecret:
                        properties:
                          key:
                            type: string
                          name:
                            type: string
                          optional:
                            type: boolean
                        required:
                          - key
                        type: object
                      enableHttp2:
                        type: boolean
                      filterRunning:
                        type: boolean
                      followRedirects:
                        type: boolean
                      honorLabels:
                        type: boolean
                      honorTimestamps:
                        type: boolean
                      interval:
                        pattern: ^(0|(([0-9]+)y)?(([0-9]+)w)?(([0-9]+)d)?(([0-9]+)h)?(([0-9]+)m)?(([0-9]+)s)?(([0-9]+)ms)?)$
                        type: string
                      metricRelabelings:
                        items:
                          properties:
                            action:
                              enum:
                                - replace
                                - Replace
                                - keep
                                - Keep
                                - drop
                                - Drop
                                - hashmod
                                - HashMod
                                - labelmap
                                - LabelMap
                                - labeldrop
                                - LabelDrop
                                - labelkeep
                                - LabelKeep
                                - lowercase
                                - Lowercase
                                - uppercase
                                - Uppercase
                                - keepequal
                                - KeepEqual
                                - dropequal
                                - DropEqual
                              type: string
                            modulus:
                              format: int64
                              type: integer
                            regex:
                              type: string
                            replacement:
                              type: string
                            separator:
                              type: string
                            sourceLabels:
                              items:
                                pattern: ^[a-zA-Z_][a-zA-Z0-9_]*$
                                type: string
                              type: array
                            targetLabel:
                              type: string
                          type: object
                        type: array
                      oauth2:
                        properties:
                          clientId:
                            properties:
                              configMap:
                                properties:
                                  key:
                                    type: string
                                  name:
                                    type: string
                                  optional:
                                    type: boolean
                                required:
                                  - key
                                type: object
                              secret:
                                properties:
                                  key:
                                    type: string
                                  name:
                                    type: string
                                  optional:
                                    type: boolean
                                required:
                                  - key
                                type: object
                            type: object
                          clientSecret:
                            properties:
                              key:
                                type: string
                              name:
                                type: string
                              optional:
                                type: boolean
                            required:
                              - key
                            type: object
                          endpointParams:
                            additionalProperties:
                              type: string
                            type: object
                          scopes:
                            items:
                              type: string
                            type: array
                          tokenUrl:
                            minLength: 1
                            type: string
                        required:
                          - clientId
                          - clientSecret
                          - tokenUrl
                        type: object
                      params:
                        additionalProperties:
                          items:
                            type: string
                          type: array
                        type: object
                      path:
                        type: string
                      port:
                        type: string
                      proxyUrl:
                        type: string
                      relabelings:
                        items:
                          properties:
                            action:
                              enum:
                                - replace
                                - Replace
                                - keep
                                - Keep
                                - drop
                                - Drop
                                - hashmod
                                - HashMod
                                - labelmap
                                - LabelMap
                                - labeldrop
                                - LabelDrop
                                - labelkeep
                                - LabelKeep
                                - lowercase
                                - Lowercase
                                - uppercase
                                - Uppercase
                                - keepequal
                                - KeepEqual
                                - dropequal
                                - DropEqual
                              type: string
                            modulus:
                              format: int64
                              type: integer
                            regex:
                              type: string
                            replacement:
                              type: string
                            separator:
                              type: string
                            sourceLabels:
                              items:
                                pattern: ^[a-zA-Z_][a-zA-Z0-9_]*$
                                type: string
                              type: array
                            targetLabel:
                              type: string
                          type: object
                        type: array
                      scheme:
                        enum:
                          - http
                          - https
                        type: string
                      scrapeTimeout:
                        pattern: ^(0|(([0-9]+)y)?(([0-9]+)w)?(([0-9]+)d)?(([0-9]+)h)?(([0-9]+)m)?(([0-9]+)s)?(([0-9]+)ms)?)$
                        type: string
                      targetPort:
                        anyOf:
                          - type: integer
                          - type: string
                        x-kubernetes-int-or-string: true
                      tlsConfig:
                        properties:
                          ca:
                            properties:
                              configMap:
                                properties:
                                  key:
                                    type: string
                                  name:
                                    type: string
                                  optional:
                                    type: boolean
                                required:
                                  - key
                                type: object
                              secret:
                                properties:
                                  key:
                                    type: string
                                  name:
                                    type: string
                                  optional:
                                    type: boolean
                                required:
                                  - key
                                type: object
                            type: object
                          caFile:
                            type: string
                          cert:
                            properties:
                              configMap:
                                properties:
                                  key:
                                    type: string
                                  name:
                                    type: string
                                  optional:
                                    type: boolean
                                required:
                                  - key
                                type: object
                              secret:
                                properties:
                                  key:
                                    type: string
                                  name:
                                    type: string
                                  optional:
                                    type: boolean
                                required:
                                  - key
                                type: object
                            type: object
                          certFile:
                            type: string
                          insecureSkipVerify:
                            type: boolean
                          keyFile:
                            type: string
                          keySecret:
                            properties:
                              key:
                                type: string
                              name:
                                type: string
                              optional:
                                type: boolean
                            required:
                              - key
                            type: object
                          serverName:
                            type: string
                        type: object
                      trackTimestampsStaleness:
                        type: boolean
                    type: object
                  type: array
                jobLabel:
                  type: string
                keepDroppedTargets:
                  format: int64
                  type: integer
                labelLimit:
                  format: int64
                  type: integer
                labelNameLengthLimit:
                  format: int64
                  type: integer
                labelValueLengthLimit:
                  format: int64
                  type: integer
                namespaceSelector:
                  properties:
                    any:
                      type: boolean
                    matchNames:
                      items:
                        type: string
                      type: array
                  type: object
                podTargetLabels:
                  items:
                    type: string
                  type: array
                sampleLimit:
                  format: int64
                  type: integer
                scrapeClass:
                  minLength: 1
                  type: string
                scrapeProtocols:
                  items:
                    enum:
                      - PrometheusProto
                      - OpenMetricsText0.0.1
                      - OpenMetricsText1.0.0
                      - PrometheusText0.0.4
                    type: string
                  type: array
                selector:
                  properties:
                    matchExpressions:
                      items:
                        properties:
                          key:
                            type: string
                          operator:
                            type: string
                          values:
                            items:
                              type: string
                            type: array
                        required:
                          - key
                          - operator
                        type: object
                      type: array
                    matchLabels:
                      additionalProperties:
                        type: string
                      type: object
                  type: object
                targetLabels:
                  items:
                    type: string
                  type: array
                targetLimit:
                  format: int64
                  type: integer
              required:
                - endpoints
                - selector
              type: object
          required:
            - spec
          type: object
      served: true
      storage: true
