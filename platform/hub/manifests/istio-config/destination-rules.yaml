# DestinationRules for traffic policies
# All services in mesh use ISTIO_MUTUAL for mTLS
---
apiVersion: networking.istio.io/v1
kind: DestinationRule
metadata:
  name: grafana
  namespace: istio-ingress
spec:
  host: grafana.observability.svc.cluster.local
  trafficPolicy:
    tls:
      mode: ISTIO_MUTUAL
---
apiVersion: networking.istio.io/v1
kind: DestinationRule
metadata:
  name: mimir
  namespace: istio-ingress
spec:
  host: mimir-gateway.observability.svc.cluster.local
  trafficPolicy:
    tls:
      mode: ISTIO_MUTUAL
---
apiVersion: networking.istio.io/v1
kind: DestinationRule
metadata:
  name: loki
  namespace: istio-ingress
spec:
  host: loki-gateway.observability.svc.cluster.local
  trafficPolicy:
    tls:
      mode: ISTIO_MUTUAL
---
apiVersion: networking.istio.io/v1
kind: DestinationRule
metadata:
  name: tempo
  namespace: istio-ingress
spec:
  host: tempo.observability.svc.cluster.local
  trafficPolicy:
    tls:
      mode: ISTIO_MUTUAL
---
apiVersion: networking.istio.io/v1
kind: DestinationRule
metadata:
  name: argocd
  namespace: istio-ingress
spec:
  host: argocd-server.argocd.svc.cluster.local
  trafficPolicy:
    tls:
      mode: ISTIO_MUTUAL
---
apiVersion: networking.istio.io/v1
kind: DestinationRule
metadata:
  name: openbao
  namespace: istio-ingress
spec:
  host: openbao.openbao.svc.cluster.local
  trafficPolicy:
    tls:
      mode: ISTIO_MUTUAL
---
apiVersion: networking.istio.io/v1
kind: DestinationRule
metadata:
  name: kiali
  namespace: istio-ingress
spec:
  host: kiali.istio-system.svc.cluster.local
  trafficPolicy:
    tls:
      mode: DISABLE  # Kiali in istio-system has no sidecar
---
apiVersion: networking.istio.io/v1
kind: DestinationRule
metadata:
  name: seaweedfs
  namespace: observability
spec:
  host: "*.seaweedfs.svc.cluster.local"
  trafficPolicy:
    tls:
      mode: ISTIO_MUTUAL
