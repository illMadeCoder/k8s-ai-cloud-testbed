# VirtualServices for path-based routing
# Routes traffic from Istio Gateway to backend services
---
apiVersion: networking.istio.io/v1
kind: VirtualService
metadata:
  name: grafana
  namespace: istio-ingress
spec:
  hosts:
    - "*"
  gateways:
    - main-gateway
  http:
    - match:
        - uri:
            prefix: /grafana
      route:
        - destination:
            host: grafana.observability.svc.cluster.local
            port:
              number: 80
      # No rewrite - Grafana handles /grafana subpath via serve_from_sub_path
---
apiVersion: networking.istio.io/v1
kind: VirtualService
metadata:
  name: mimir
  namespace: istio-ingress
spec:
  hosts:
    - "*"
  gateways:
    - main-gateway
  http:
    - match:
        - uri:
            prefix: /mimir
      rewrite:
        uri: /
      route:
        - destination:
            host: mimir-gateway.observability.svc.cluster.local
            port:
              number: 80
---
apiVersion: networking.istio.io/v1
kind: VirtualService
metadata:
  name: loki
  namespace: istio-ingress
spec:
  hosts:
    - "*"
  gateways:
    - main-gateway
  http:
    - match:
        - uri:
            prefix: /loki
      rewrite:
        uri: /
      route:
        - destination:
            host: loki-gateway.observability.svc.cluster.local
            port:
              number: 80
---
apiVersion: networking.istio.io/v1
kind: VirtualService
metadata:
  name: tempo
  namespace: istio-ingress
spec:
  hosts:
    - "*"
  gateways:
    - main-gateway
  http:
    - match:
        - uri:
            prefix: /tempo
      rewrite:
        uri: /
      route:
        - destination:
            host: tempo.observability.svc.cluster.local
            port:
              number: 3100
---
apiVersion: networking.istio.io/v1
kind: VirtualService
metadata:
  name: argocd
  namespace: istio-ingress
spec:
  hosts:
    - "*"
  gateways:
    - main-gateway
  http:
    - match:
        - uri:
            prefix: /argocd
      rewrite:
        uri: /
      route:
        - destination:
            host: argocd-server.argocd.svc.cluster.local
            port:
              number: 80
---
apiVersion: networking.istio.io/v1
kind: VirtualService
metadata:
  name: openbao
  namespace: istio-ingress
spec:
  hosts:
    - "*"
  gateways:
    - main-gateway
  http:
    - match:
        - uri:
            prefix: /openbao
      rewrite:
        uri: /
      route:
        - destination:
            host: openbao.openbao.svc.cluster.local
            port:
              number: 8200
---
apiVersion: networking.istio.io/v1
kind: VirtualService
metadata:
  name: kiali
  namespace: istio-ingress
spec:
  hosts:
    - "*"
  gateways:
    - main-gateway
  http:
    - match:
        - uri:
            prefix: /kiali
      route:
        - destination:
            host: kiali.istio-system.svc.cluster.local
            port:
              number: 20001
      # No rewrite - Kiali handles /kiali subpath via web_root config
