# Tutorial configuration
# When this file exists, `task kind:conduct` runs in interactive mode

title: "CLOUDBREAK STATION - Systems Monitoring Division"
description: |
  Prometheus & Grafana orientation for new Systems Monitoring Technicians.
  Weyland-Ishimura Corp. Standard Training Protocol. See README.md for full orientation.

instructions: |
  ╔══════════════════════════════════════════════════════════════════════╗
  ║  CLOUDBREAK STATION          ║  SYSTEMS MONITORING TERMINAL          ║
  ╠══════════════════════════════════════════════════════════════════════╣
  ║  Welcome, Technician. Your orientation begins now.                   ║
  ║  Station status: NOMINAL (probably)                                  ║
  ╚══════════════════════════════════════════════════════════════════════╝

  ┌─────────────────────────────────────────────────────────────────────┐
  │  RECOMMENDED SETUP: Split your screen                               │
  │                                                                     │
  │  ┌─────────────────────┐  ┌─────────────────────┐                   │
  │  │                     │  │                     │                   │
  │  │     TERMINAL        │  │     BROWSER         │                   │
  │  │  (this window)      │  │  (Grafana)          │                   │
  │  │                     │  │                     │                   │
  │  └─────────────────────┘  └─────────────────────┘                   │
  │                                                                     │
  │  Run commands in terminal. Watch metrics change in Grafana.         │
  └─────────────────────────────────────────────────────────────────────┘

  ## Step 1: Set Your Environment Variables

  Copy the IPs shown above into these exports:
  ```bash
  export METRICS_IP=<metrics-app-ip>
  export STATION_IP=<station-monitor-ip>
  export PROM_IP=<prometheus-ip>
  export GRAFANA_IP=<grafana-ip>
  ```

  ═══════════════════════════════════════════════════════════════════════
  CHECKPOINT 1: VERIFY SYSTEMS ONLINE (Terminal Only)
  ═══════════════════════════════════════════════════════════════════════

  Quick smoke test - all should return data:
  ```bash
  curl -s http://$METRICS_IP/ | head -1
  curl -s http://$STATION_IP/ | head -1
  curl -s "http://$PROM_IP:9090/api/v1/targets" | jq '.data.activeTargets | length'
  ```

  Expected: "Hello from metrics-app...", "CLOUDBREAK STATION...", and "11" or higher.

  ╔══════════════════════════════════════════════════════════════════════╗
  ║                                                                      ║
  ║   >>> STOP: OPEN GRAFANA IN YOUR BROWSER NOW <<<                     ║
  ║                                                                      ║
  ╚══════════════════════════════════════════════════════════════════════╝

  ═══════════════════════════════════════════════════════════════════════
  CHECKPOINT 2: OPEN GRAFANA AND FIND THE DASHBOARDS
  ═══════════════════════════════════════════════════════════════════════

  1. Open your browser to: http://<grafana-ip>:80
     (Use the GRAFANA_IP from above)

  2. Login:
     - Username: admin
     - Password: admin
     - Click "Skip" when asked to change password

  3. Find the dashboards:
     - Click the hamburger menu (three lines, top-left)
     - Click "Dashboards"
     - You should see TWO custom dashboards:

       * "Cloudbreak Station Monitor"  <-- Open this one first
       * "RED Metrics - metrics-app"

  4. Click "Cloudbreak Station Monitor" to open it

  ═══════════════════════════════════════════════════════════════════════
  CHECKPOINT 3: UNDERSTAND THE DASHBOARD LAYOUT
  ═══════════════════════════════════════════════════════════════════════

  You should now see the Cloudbreak Station dashboard. Let's identify
  the key panels:

  ┌─────────────────────────────────────────────────────────────────────┐
  │  TOP ROW - Station Vital Signs (4 stat panels)                      │
  │  ┌────────────┬────────────┬────────────┬────────────┐              │
  │  │   CREW     │CONTAINMENT │  BEACON    │ ANOMALIES  │              │
  │  │   ~2847    │   ~100%    │  SILENT    │     0      │              │
  │  │  (green)   │  (green)   │  (green)   │  (green)   │              │
  │  └────────────┴────────────┴────────────┴────────────┘              │
  │                                                                     │
  │  MIDDLE ROW - Time Series (2 graphs)                                │
  │  ┌─────────────────────────┬─────────────────────────┐              │
  │  │  Crew Complement        │  Containment & Beacon   │              │
  │  │  Over Time              │  Over Time              │              │
  │  └─────────────────────────┴─────────────────────────┘              │
  │                                                                     │
  │  SECTOR STATUS ROW - Bar Gauges                                     │
  │  ┌─────────────────────────┬─────────────────────────┐              │
  │  │  Life Support           │  Sector Status          │              │
  │  │  by Sector              │  by Sector              │              │
  │  └─────────────────────────┴─────────────────────────┘              │
  │                                                                     │
  │  SECTOR 12 ROW - The Anomaly Zone                                   │
  │  ┌────────────┬────────────┬─────────────────────────┐              │
  │  │  Request   │   Error    │  Response Time          │              │
  │  │   Rate     │   Rate     │  (p50/p95/p99)          │              │
  │  └────────────┴────────────┴─────────────────────────┘              │
  └─────────────────────────────────────────────────────────────────────┘

  VERIFY these panels are visible. If the dashboard looks empty,
  set the time range to "Last 30 minutes" (top-right dropdown).

  Current station status should show:
  [ ] Crew Complement: ~2847 (green number)
  [ ] Containment: ~100% (green)
  [ ] Beacon: "SILENT" (green background)
  [ ] Life Support bars: Mostly green (Sector 12 may already be yellow/red)

  ╔══════════════════════════════════════════════════════════════════════╗
  ║                                                                      ║
  ║   >>> KEEP GRAFANA OPEN - YOU'LL WATCH IT CHANGE <<<                 ║
  ║                                                                      ║
  ╚══════════════════════════════════════════════════════════════════════╝

  ═══════════════════════════════════════════════════════════════════════
  CHECKPOINT 4: GENERATE ACTIVITY AND WATCH THE DASHBOARD
  ═══════════════════════════════════════════════════════════════════════

  Now comes the fun part. You'll run commands in your terminal while
  watching the Grafana dashboard update in real-time.

  ARRANGE YOUR WINDOWS: Terminal on left, Grafana browser on right.

  ┌─────────────────────────────────────────────────────────────────────┐
  │  WHAT TO WATCH IN GRAFANA:                                          │
  │                                                                     │
  │  1. TOP-LEFT STAT: "Crew Complement"                                │
  │     - Number will slowly decrease                                   │
  │     - Color changes: green -> yellow -> red                         │
  │                                                                     │
  │  2. TOP-MIDDLE STAT: "Containment Integrity"                        │
  │     - Percentage drops as you hit Sector 12                         │
  │     - Watch for color change at 95%, 80%                            │
  │                                                                     │
  │  3. TOP-RIGHT-ISH STAT: "Beacon Signal"                             │
  │     - Starts as "SILENT" (green)                                    │
  │     - Changes to "DETECTED" (yellow)                                │
  │     - Then "STRONG" (orange) and "MAXIMUM" (red)                    │
  │                                                                     │
  │  4. SECTOR STATUS BARS: Watch Sector 12, 13, 14                     │
  │     - Sector 12 bar shrinks and turns red                           │
  │     - Sectors 13-14 start degrading (spreading effect)              │
  └─────────────────────────────────────────────────────────────────────┘

  IN YOUR TERMINAL, run this command:
  ```bash
  echo "Accessing Sector 12 systems..." && \
  for i in {1..30}; do
    curl -s http://$STATION_IP/sector12
    echo ""
    sleep 1
  done
  ```

  *** WATCH GRAFANA WHILE THIS RUNS ***

  You should see:
  - The Sector 12 request rate graph showing activity
  - Error rate gauge climbing (Sector 12 has 70% failures)
  - Containment percentage dropping
  - Beacon signal changing from SILENT

  Wait for the command to finish, then check the dashboard again.

  ═══════════════════════════════════════════════════════════════════════
  CHECKPOINT 5: OBSERVE THE DAMAGE
  ═══════════════════════════════════════════════════════════════════════

  After running the Sector 12 commands, examine the dashboard:

  EXPECTED CHANGES:
  [ ] Crew count dropped (watch the time series graph for the decline)
  [ ] Containment is below 100% (maybe below 95% - yellow alert zone)
  [ ] Beacon is no longer "SILENT"
  [ ] Sector 12 life support bar is RED (< 40%)
  [ ] Sectors 13-14 bars may be YELLOW (spreading effect)

  Compare the LEFT side of the time series graphs (before) to the
  RIGHT side (after). You're seeing the station degrade in real-time.

  ═══════════════════════════════════════════════════════════════════════
  CHECKPOINT 6: CHECK THE ALERTS
  ═══════════════════════════════════════════════════════════════════════

  The degradation should have triggered alerts. Check two ways:

  IN GRAFANA:
  1. Click the hamburger menu (three lines, top-left)
  2. Click "Alerting" -> "Alert rules"
  3. Look for alerts with names starting with:
     - "CrewComplement..."
     - "Containment..."
     - "BeaconSignal..."

  IN TERMINAL:
  ```bash
  curl -s "http://$PROM_IP:9090/api/v1/alerts" | \
    jq -r '.data.alerts[] | "\(.state): \(.labels.alertname)"' | \
    grep -E "Crew|Containment|Beacon|Sector" | sort
  ```

  You should see alerts like:
  - FIRING: CrewComplementDeclining
  - FIRING: ContainmentIntegrityDegraded
  - FIRING: BeaconSignalDetected

  ╔══════════════════════════════════════════════════════════════════════╗
  ║                                                                      ║
  ║   >>> NOW EXPLORE: RED METRICS DASHBOARD <<<                         ║
  ║                                                                      ║
  ╚══════════════════════════════════════════════════════════════════════╝

  ═══════════════════════════════════════════════════════════════════════
  CHECKPOINT 7: EXPLORE THE RED METRICS DASHBOARD
  ═══════════════════════════════════════════════════════════════════════

  Go back to the Grafana dashboard list and open:
  "RED Metrics - metrics-app"

  This dashboard shows the THREE GOLDEN SIGNALS of monitoring:
  - Rate:     How many requests per second?
  - Errors:   What percentage are failing?
  - Duration: How long do requests take?

  ┌─────────────────────────────────────────────────────────────────────┐
  │  RED DASHBOARD LAYOUT:                                              │
  │                                                                     │
  │  TOP ROW - Current Values                                           │
  │  ┌────────────┬────────────┬────────────┬────────────┐              │
  │  │  REQUEST   │   ERROR    │    P95     │   ACTIVE   │              │
  │  │   RATE     │   RATE     │  LATENCY   │   CONNS    │              │
  │  └────────────┴────────────┴────────────┴────────────┘              │
  │                                                                     │
  │  RATE SECTION - Request throughput                                  │
  │  ┌─────────────────────────┬─────────────────────────┐              │
  │  │  Rate by Endpoint       │  Rate by Status Code    │              │
  │  │  (/, /slow, /error)     │  (200, 500)             │              │
  │  └─────────────────────────┴─────────────────────────┘              │
  │                                                                     │
  │  ERRORS SECTION - Failure analysis                                  │
  │  ┌─────────────────────────┬─────────────────────────┐              │
  │  │  Error Rate by Endpoint │  Total Errors           │              │
  │  └─────────────────────────┴─────────────────────────┘              │
  │                                                                     │
  │  DURATION SECTION - Latency analysis                                │
  │  ┌─────────────────────────┬─────────────────────────┐              │
  │  │  Latency Percentiles    │  P95 by Endpoint        │              │
  │  │  (p50, p90, p95, p99)   │                         │              │
  │  └─────────────────────────┴─────────────────────────┘              │
  └─────────────────────────────────────────────────────────────────────┘

  Generate varied traffic to see the dashboard in action:
  ```bash
  echo "Generating mixed traffic..." && \
  for i in {1..20}; do
    curl -s http://$METRICS_IP/ > /dev/null
    curl -s http://$METRICS_IP/slow > /dev/null &
    curl -s http://$METRICS_IP/error > /dev/null
    sleep 0.5
  done && \
  wait && echo "Done!"
  ```

  *** WATCH GRAFANA WHILE THIS RUNS ***

  OBSERVE:
  [ ] Request rate spikes in the "Rate by Endpoint" graph
  [ ] /slow endpoint shows HIGHER latency than / in the percentile chart
  [ ] /error endpoint shows ~30% error rate (red in the error graph)
  [ ] Status code graph shows mix of 200s (green) and 500s (red)

  ═══════════════════════════════════════════════════════════════════════
  CHECKPOINT 8: THE INVESTIGATION (Optional Deep Dive)
  ═══════════════════════════════════════════════════════════════════════

  Return to the Cloudbreak Station dashboard. Use PromQL to investigate
  what's happening. In Prometheus (http://<prom-ip>:9090), try these queries:

  Crew loss over time:
  ```
  station_crew_complement
  ```

  Rate of containment degradation:
  ```
  deriv(station_containment_integrity[5m])
  ```

  Sector 12 error rate:
  ```
  sum(rate(station_sector_requests_total{sector="12",status="500"}[5m]))
  /
  sum(rate(station_sector_requests_total{sector="12"}[5m]))
  ```

  What is the beacon transmitting?
  ```bash
  for i in {1..5}; do curl http://$STATION_IP/beacon; sleep 1; done
  ```

  The answers tell a story. Something is wrong in Sector 12.

  ═══════════════════════════════════════════════════════════════════════
  FULL ORIENTATION MATERIALS
  ═══════════════════════════════════════════════════════════════════════

  This quick-start covered the basics. The full training includes:
  - Part 1: Foundations (metric types, Prometheus architecture)
  - Part 2: PromQL Mastery (rate, histogram_quantile, aggregations)
  - Part 3: SRE Methodology (Four Golden Signals, SLOs)
  - Part 4: Production Patterns (alerting best practices)
  - Part 5: Grafana Dashboards (building your own)
  - Part 6: Sector 12 Investigation [CLASSIFIED]

  Access full orientation:
  ```bash
  less experiments/prometheus-tutorial/README.md
  ```

  ═══════════════════════════════════════════════════════════════════════
  END SESSION
  ═══════════════════════════════════════════════════════════════════════

  Press ENTER when your shift is complete.

  ─────────────────────────────────────────────────────────────────────
  NOTE: If you hear unusual sounds from the maintenance shafts,
        please log an acoustic anomaly report. Do not investigate.
  ─────────────────────────────────────────────────────────────────────
