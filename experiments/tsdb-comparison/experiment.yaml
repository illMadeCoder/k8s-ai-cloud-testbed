apiVersion: experiments.illm.io/v1alpha1
kind: Experiment
metadata:
  generateName: tsdb-comparison-
  namespace: experiments
spec:
  description: "TSDB comparison - Prometheus vs VictoriaMetrics vs Mimir resource efficiency and query performance"
  tags: ["comparison", "observability", "metrics"]
  publish: true
  ttlDays: 7

  analysis:
    sections:
      - abstract
      - targetAnalysis
      - performanceAnalysis
      - metricInsights
      - finopsAnalysis
      - secopsAnalysis
      - body
      - capabilitiesMatrix
      - feedback
      - architectureDiagram

  study:
    hypothesis: "VictoriaMetrics will be the most resource-efficient for single-node deployments because its merge-tree storage engine and single-binary architecture avoid the per-component overhead of distributed systems, while Mimir will offer superior horizontal scalability because its microservices architecture (ingesters, compactors, store-gateways) allows independent scaling of each concern at the cost of higher base resource usage"
    questions:
      - "What is the CPU and memory usage per ingested metric across all three TSDBs?"
      - "How does query performance compare for common dashboard-style PromQL queries?"
      - "What are the operational trade-offs between Prometheus' pull model, VM's fork optimizations, and Mimir's microservices architecture?"
    focus:
      - "resource efficiency per metric"
      - "query performance"
      - "horizontal scalability"
      - "operational complexity"

  targets:
    - name: app
      cluster:
        type: gke
        preemptible: true
      observability:
        enabled: true
        transport: tailscale
      components:
        - app: kube-prometheus-stack
          params:
            grafana.enabled: "true"
            prometheus.prometheusSpec.retention: "24h"
            alertmanager.enabled: "false"
        - app: victoria-metrics
        - app: mimir
        - app: minio
        - app: cardinality-generator

  workflow:
    template: tsdb-comparison-validation
    completion:
      mode: workflow
