# nginx-ingress Helm values for Gateway Tutorial
# Configured for Kind cluster with MetalLB

controller:
  # Use LoadBalancer service type (MetalLB provides external IP)
  service:
    type: LoadBalancer
    annotations:
      # Allow sharing IP with other LoadBalancers if needed
      metallb.universe.tf/allow-shared-ip: "gateway-tutorial"

  # Enable metrics for observability
  metrics:
    enabled: true
    serviceMonitor:
      enabled: false  # Enable if Prometheus is deployed

  # Resource limits appropriate for Kind
  resources:
    requests:
      cpu: 100m
      memory: 128Mi
    limits:
      cpu: 500m
      memory: 256Mi

  # Enable access logs for debugging
  config:
    log-format-upstream: '$remote_addr - $remote_user [$time_local] "$request" $status $body_bytes_sent "$http_referer" "$http_user_agent" $request_length $request_time [$proxy_upstream_name] [$proxy_alternative_upstream_name] $upstream_addr $upstream_response_length $upstream_response_time $upstream_status $req_id'
    # Enable snippets for advanced configurations (Part 2)
    # allow-snippet-annotations: enables snippet parsing
    # annotations-risk-level: Critical allows server-snippet and configuration-snippet
    allow-snippet-annotations: "true"
    annotations-risk-level: "Critical"

  # Admission webhooks
  admissionWebhooks:
    enabled: true

  # Watch all namespaces
  watchIngressWithoutClass: true

  # Default IngressClass
  ingressClassResource:
    name: nginx
    enabled: true
    default: true
    controllerValue: "k8s.io/ingress-nginx"

# Disable default backend (we'll use our demo apps)
defaultBackend:
  enabled: false
