# Argo Workflow - runs on orchestrator cluster
# Coordinates the experiment across all clusters
apiVersion: argoproj.io/v1alpha1
kind: Workflow
metadata:
  generateName: experiment-
spec:
  entrypoint: run-experiment
  arguments:
    parameters:
      - name: target-url
        value: "http://target-app.default.svc"
      - name: duration
        value: "60s"
      - name: users
        value: "10"

  templates:
    - name: run-experiment
      steps:
        - - name: load-test
            template: k6-load-test

    - name: k6-load-test
      container:
        image: grafana/k6:latest
        command: ["k6", "run", "-"]
        stdin: true
        # Add your k6 script here or mount from ConfigMap
