# OpenBao Helm values for Kind hub
#
# Uses file storage with hostPath for persistence across cluster recreations.
# Data persists in ~/.illmlab/openbao-data on the host.
#
# After bootstrap, OpenBao needs to be initialized and unsealed:
#   - First run: `bao operator init` (saves keys to ~/.illmlab/openbao-keys.json)
#   - Subsequent runs: `bao operator unseal` with saved keys

global:
  enabled: true

server:
  # Disable dev mode - use real storage
  dev:
    enabled: false

  # Resource limits for Kind
  resources:
    requests:
      cpu: 100m
      memory: 128Mi
    limits:
      cpu: 500m
      memory: 256Mi

  # Expose via LoadBalancer for Kind
  service:
    type: LoadBalancer

  # File storage configuration
  dataStorage:
    enabled: true
    size: 1Gi
    storageClass: null  # Use default
    accessMode: ReadWriteOnce

  # Standalone mode (no HA for local dev)
  standalone:
    enabled: true
    config: |
      ui = true

      listener "tcp" {
        tls_disable = 1
        address = "[::]:8200"
        cluster_address = "[::]:8201"
      }

      storage "file" {
        path = "/vault/data"
      }

  # HA disabled for local dev
  ha:
    enabled: false

  # Use hostPath volume for persistence across cluster recreations
  volumes:
    - name: openbao-persistent
      hostPath:
        path: /mnt/openbao-data
        type: DirectoryOrCreate

  volumeMounts:
    - name: openbao-persistent
      mountPath: /vault/data

# Injector for automatic secret injection into pods
injector:
  enabled: true
  resources:
    requests:
      cpu: 50m
      memory: 64Mi
    limits:
      cpu: 250m
      memory: 128Mi

# CSI provider for mounting secrets as volumes
csi:
  enabled: false

# UI enabled
ui:
  enabled: true
