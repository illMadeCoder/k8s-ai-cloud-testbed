# Kustomization for MetalLB Config
#
# Uses replacements to inject environment-specific values.
# Edit the ConfigMap below to customize for your Kind network.

apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

resources:
  - pool.yaml
  - wait-for-webhook.yaml
  - wait-rbac.yaml

# Environment-specific values
# Change these to match your Kind docker network subnet
configMapGenerator:
  - name: metallb-env
    namespace: metallb-system
    literals:
      - POOL_RANGE=172.19.255.200-172.19.255.250
    options:
      disableNameSuffixHash: true

replacements:
  - source:
      kind: ConfigMap
      name: metallb-env
      fieldPath: data.POOL_RANGE
    targets:
      - select:
          kind: IPAddressPool
          name: kind-pool
        fieldPaths:
          - spec.addresses.0
