apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

# Webhook Relay Configuration
#
# To configure:
#   1. Go to https://smee.io/new in browser
#   2. Copy the channel URL
#   3. Replace PLACEHOLDER_SMEE_URL below
#   4. Commit and push - ArgoCD will sync

resources:
  - deployment.yaml

# Environment-specific configuration
# SMEE_URL: Your smee.io channel URL (e.g., https://smee.io/aBcDeFgHiJkLmNo)
# WEBHOOK_SECRET: Shared secret for GitHub webhook authentication

configMapGenerator:
  - name: webhook-relay-env
    namespace: argocd
    literals:
      - SMEE_URL=https://smee.io/9UsxkA4arh5BMoY
    options:
      disableNameSuffixHash: true

replacements:
  - source:
      kind: ConfigMap
      name: webhook-relay-env
      fieldPath: data.SMEE_URL
    targets:
      - select:
          kind: Deployment
          name: smee-client
        fieldPaths:
          - spec.template.spec.containers.[name=smee-client].args.1
